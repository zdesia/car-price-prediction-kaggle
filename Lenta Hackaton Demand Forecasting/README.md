# Прогнозирование спроса товаров для “Лента”

Проектное  участие в кросс-функциональном хакатоне по разработке ML-продукта предсказательной модели для ООО “Лента” (сентябрь 2023 г.)

### Результат работы команды:
Серверное приложение (API), которое предназначено для работы с данными предсказательной модели через интерфейс пользователя

![Принципиальная схема проекта](https://i.ibb.co/dbNcqtk/Flowchart-Diagram.png "Принципиальная схема проекта.")

**Ссылки на репозитории коллег:**  &nbsp; &nbsp; &nbsp; [User Interface design](https://www.figma.com/file/oDb87wsTRHsC8vTtINeoBL/Команда-№1-In-Flames%2C-Хакатон.-Лента?type=design&node-id=143-3273&mode=design&t=XnoAmzIit4khUqGa-0)  &nbsp; &nbsp; &nbsp; &nbsp; [Frontend](https://github.com/Jane-Doe666/lenta) &nbsp; &nbsp; &nbsp; &nbsp; [Backend](https://github.com/kvadimas/Lenta_hackathon_backend/tree/main)




## Задача Data Science
Разработка алгоритма прогноза спроса на 14 дней для товаров собственного производства, подготовка для запуска в продуктовое использование

### Содержание репозитория DS
- [lenta-hackathon-demand-forecasting.ipynb](https://github.com/zdesia/data-competitions/blob/main/Lenta%20Hackaton%20Demand%20Forecasting/lenta-hackathon-demand-forecasting.ipynb) - Ноутбук с исследовательским анализом данных, инжинирингом признаков, обучением модели, валидацией 
-  [lenta/ml](https://github.com/zdesia/data-competitions/tree/main/Lenta%20Hackaton%20Demand%20Forecasting/lenta/ml): скрипт прогнозирования `model.py`, скрипт переобучения модели `retraining.py`, обученная модель `lgbm_model.pkl`
- [lenta/backend](https://github.com/zdesia/data-competitions/tree/main/Lenta%20Hackaton%20Demand%20Forecasting/lenta/backend): скрипт для запуска модели `app.py`

### Инструкция по запуску на локальной машине

Клонировать репозиторий

```git clone git@github.com:aminaadzhieva/lenta-hackathon-forecasting.git```   
```cd lenta-hackathon-forecasting```

Установить виртуальное окружение

```python3 -m venv venv```

Запустить виртуальное окружение

```source venv/bin/activate```

Установить все зависимости

```pip install -r lenta/requirements.txt```

Запустить сервер

```uvicorn lenta.backend.app:app```

[Запустить систему предсказания](http://127.0.0.1:8000/api/v1/forecast/custom_response_post/) &nbsp; &nbsp; &nbsp; 
[Проверить данные в админке](http://31.129.109.228/admin/)


## Описание решения
- Выбрана модель градиентного бустинга LightGBM
- Дополнителльно сгенерированы признаки:
    - календарные: день недели, число месяца, номер недели
    - лаговые признаки 1-30 дней
    - скользящее среднее 7 предыдущих дней
    - кластеризация по характеристикам магазина и товаров
- Обучение, валидация и выбор лучшего набора гиперпараметров проводится на кросс-валидации: подбор гиперпараметров на фолде проводится на valid-выборке, оценка лучшей модели на фолде на test-выборке. Далее выбирается модель лучших моделей на каждом фолде.
- Предсказание спроса обученной моделью делается последовательно на каждый следующий день с промежуточным перерасчётом лаговых признаков (учитывается предсказанное значение спроса в предыдущий день).

Для оценки модели использовалась метрика качества  **WAPE**, посчитанный на уровне магазин, товар, день (гранулярность ТК-SKU-День).  
Полученный результат: 0,46

## Взаимодействие 
- Скрипт предсказания запускается каждую ночь, генерирует предсказания для всех заданных комбинаций Магазин-Товар и записывает результат в базу данных. Пользователь взаимодействует с данными из базы данных.

  



